package service

import (
	"bytes"
	"encoding/json"
	"fmt"
	"log"
	"net/http"
	"time"

	"github.com/putteror/iot-gateway/internal/app/schema"
	"github.com/putteror/iot-gateway/internal/config"
)

// Add necessary imports here

// Add service implementation here
type DahuaCameraFaceRecognitionService interface {
	FaceRecognitionEvent(paylaod *schema.ReceiveDahuaCameraFaceRecognitionPayload) error
}

type DahuaCameraFaceRecognitionServiceImpl struct {
}

func NewDahuaCameraFaceRecognitionService() DahuaCameraFaceRecognitionService {
	return &DahuaCameraFaceRecognitionServiceImpl{}
}

// Add service methods here
func (s *DahuaCameraFaceRecognitionServiceImpl) FaceRecognitionEvent(paylaod *schema.ReceiveDahuaCameraFaceRecognitionPayload) error {

	returnJsonPayload, err := json.Marshal(paylaod)
	if err != nil {
		// จัดการกับข้อผิดพลาดในการแปลง JSON
		fmt.Printf("Error marshalling JSON: %v\n", err)
		return err
	}
	// แสดงผล JSON ที่ได้
	fmt.Printf("Received Payload JSON: %s\n", string(returnJsonPayload))

	demoBase64Image := "data:image/png;base64,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"
	now := time.Now()
	iso8601String := now.Format(time.RFC3339)

	var sendPayload schema.SendDahuaCameraFaceRecognitionPayload
	sendPayload.Type = "info"
	sendPayload.Severity = "low"
	sendPayload.TitleKey = "notis.faceDetected"
	sendPayload.ImageBase64 = demoBase64Image
	sendPayload.OccurredAt = iso8601String
	sendPayload.Meta.Kind = "face"
	sendPayload.Meta.Person.FullName = paylaod.Data.Name
	sendPayload.Meta.Person.Gender = "MALE"
	sendPayload.Meta.RawID = "face-001"
	err = json.Unmarshal(returnJsonPayload, &sendPayload)
	if err != nil {
		fmt.Printf("Error unmarshalling JSON: %v\n", err)
		return err
	}
	convertedJsonPayload, err := json.Marshal(sendPayload)
	if err != nil {
		// จัดการกับข้อผิดพลาดในการแปลง JSON
		fmt.Printf("Error marshalling JSON: %v\n", err)
		return err
	}
	// แสดงผล JSON ที่ได้
	fmt.Printf("Converted Payload JSON: %s\n", string(convertedJsonPayload))

	webhookUrl := config.WEBHOOK_HOST_ADDRESS
	log.Println("Webhook URL:", webhookUrl)

	// 2. ส่ง HTTP POST request
	resp, err := http.Post(webhookUrl, "application/json", bytes.NewBuffer(convertedJsonPayload))
	if err != nil {
		fmt.Printf("Error sending webhook POST request: %v\n", err)
		return err
	}
	// 3. ปิด body ของ response เพื่อไม่ให้เกิด resource leak
	defer resp.Body.Close()

	// 4. ตรวจสอบสถานะของ HTTP response (ไม่จำเป็นต้องอ่าน body ถ้าไม่ต้องการ)
	if resp.StatusCode != http.StatusOK {
		fmt.Printf("Webhook responded with status code: %d\n", resp.StatusCode)
	} else {
		fmt.Println("Webhook sent successfully.")
	}

	return nil
}
